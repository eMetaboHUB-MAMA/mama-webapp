$(document).ready(function(){loadLang();var a="user";buildRangeDate();buildGraph();$("#link-donwload-xls-file").attr("href",$("#link-donwload-xls-file").attr("href")+document.location.search.replace("?page=statistics",""));if(getUrlParameter("from")===undefined){$("#link-donwload-xls-file").attr("href",$("#link-donwload-xls-file").attr("href")+"&from="+lastYear)}if(getUrlParameter("to")===undefined){$("#link-donwload-xls-file").attr("href",$("#link-donwload-xls-file").attr("href")+"&to="+today)}});function buildRangeDate(){if(getUrlParameter("from")!==undefined){$("#range-date-start").val(getUrlParameter("from"))}else{$("#range-date-start").val(lastYear)}if(getUrlParameter("to")!==undefined){$("#range-date-end").val(getUrlParameter("to"))}else{$("#range-date-end").val(today)}$(document).ready(function(){$(".datepicker").datepicker()})}$("#range-date-update").bind("click",function(a){reloadPage()});function reloadPage(){var a="?page=statistics";if($("#range-date-start").val()!=""){a+="&from="+$("#range-date-start").val()}if($("#range-date-end").val()!=""){a+="&to="+$("#range-date-end").val()}document.location=a}function buildGraph(){var b=$("#range-date-start").val();var a=$("#range-date-end").val();setTimeout(function(){buildTabPFxStatus(b,a)},10);setTimeout(function(){buildLaboTypeChart(b,a)},20);setTimeout(function(){buildCopartnerChart(b,a)},30);setTimeout(function(){buildDemandsChart(b,a)},40);setTimeout(function(){buildTargetedChart(b,a)},60);setTimeout(function(){buildSampleNbChart(b,a)},70);setTimeout(function(){buildFinancialChart(b,a)},80);setTimeout(function(){buildUserLaboTypeChart(b,a)},90);setTimeout(function(){buildExtraLaboTypeChart(b,a)},100);setTimeout(function(){buildThematicChart(b,a)},110);setTimeout(function(){buildSubThematicChart(b,a)},120)}function buildTabPFxStatus(A,f){var F=[];$.ajax({type:"get",url:"ajax/ajax_proxypass.php?verbe=get&resource=mth-platforms&order=asc",dataType:"json",async:false,success:function(I){F=(I)},error:function(I){console.log(I)}});console.log(F);$("#statsPjPFxStatus").empty();var C=0;var x=0;var n=0;var w=0;var l=0;var z=0;var t=0;var E=0;var j=0;$.each(F,function(L,K){var O=K.name;var N=K.id;var P=(getNbOf(A,f,"isPlatForm="+N+"&group=status"))[0];var J=P;var M=J.rejected+J.assigned+J.accepted+J.completed+J.running;M+=J.blocked+J.archived+J.waiting;C+=M;J.total=M;var I="<tr>";I+="<td>"+O+"</td>";I+="<td>"+J.rejected+"</td>";I+="<td>"+J.waiting+"</td>";I+="<td>"+J.assigned+"</td>";I+="<td>"+J.completed+"</td>";I+="<td>"+J.accepted+"</td>";I+="<td>"+J.running+"</td>";I+="<td>"+J.blocked+"</td>";I+="<td>"+J.archived+"</td>";I+="<td>"+J.total+"</td>";I+="</tr>";$("#statsPjPFxStatus").append(I)});var d=(getNbOf(A,f,"&isStatus=&isNotStatus=&group=status"))[0];var g=0;var q=d;var g=q.rejected+q.assigned+q.accepted+q.completed+q.running;g+=q.blocked+q.archived+q.waiting;q.total=g;var i=(getNbOf(A,f,"isStatus=rejected&isNotStatus=&group=mthPF"));var s=(getNbOf(A,f,"isStatus=waiting&isNotStatus=&group=mthPF"));var h=(getNbOf(A,f,"isStatus=assigned&isNotStatus=&group=mthPF"));var D=(getNbOf(A,f,"isStatus=accepted&isNotStatus=&group=mthPF"));var u=(getNbOf(A,f,"isStatus=completed&isNotStatus=&group=mthPF"));var v=(getNbOf(A,f,"isStatus=running&isNotStatus=&group=mthPF"));var r=(getNbOf(A,f,"isStatus=blocked&isNotStatus=&group=mthPF"));var B=(getNbOf(A,f,"isStatus=archived&isNotStatus=&group=mthPF"));var p=extractFromRaw(i);var c=extractFromRaw(s);var o=extractFromRaw(h);var a=extractFromRaw(D);var G=extractFromRaw(u);var e=extractFromRaw(v);var b=extractFromRaw(r);var H=extractFromRaw(B);var k=(p+c+o+a+G+e+b+H);var y="<tr>";y+='<td><span style="display: none">Åº</span>NONE</td>';y+="<td>"+(p)+"</td>";y+="<td>"+(c)+"</td>";y+="<td>"+(o)+"</td>";y+="<td>"+(G)+"</td>";y+="<td>"+(a)+"</td>";y+="<td>"+(e)+"</td>";y+="<td>"+(b)+"</td>";y+="<td>"+(H)+"</td>";y+="<td>"+(k)+"</td>";y+="</tr>";$("#statsPjPFxStatus").append(y);var m="<tr>";m+="<td>Total</td>";m+="<td>"+(q.rejected)+"</td>";m+="<td>"+(q.waiting)+"</td>";m+="<td>"+(q.assigned)+"</td>";m+="<td>"+(q.completed)+"</td>";m+="<td>"+(q.accepted)+"</td>";m+="<td>"+(q.running)+"</td>";m+="<td>"+(q.blocked)+"</td>";m+="<td>"+(q.archived)+"</td>";m+="<td>"+(q.total)+"</td>";m+="</tr>";$("#statsPjPFxStatusFooter").empty();$("#statsPjPFxStatusFooter").append(m);$("#statsPjPFxStatusTable").tablesorter()}function extractFromRaw(a){if((a[0])!==undefined&&(a[0]).pf_ids===null){return(a[0]).projects_count}else{if((a).pf_ids===null){return(a).projects_count}}return 0}function buildUserLaboTypeChart(d,c){var b=(getNbOf(d,c,"&group=laboratory","users-statistics"))[0];var a=[{name:"Laboratory",colorByPoint:true,data:[{name:"Private",y:b.u_labo_private},{name:"Public",y:b.u_labo_public},{name:"Public / Private",y:b.u_labo_public_private}]}];buildGenericPie("#container-pie-usersLabo"," active users laboratories profiles ",a)}function buildExtraLaboTypeChart(d,c){var b=(getNbOf(d,c,"&group=laboratory","extra-data-statistics"))[0];var a=[{name:"Laboratory",colorByPoint:true,data:[{name:"Private",y:b.e_labo_private},{name:"Public",y:b.e_labo_public},{name:"Public / Private",y:b.e_labo_public_private}]}];buildGenericPie("#container-pie-extraLabo"," projects laboratories profiles ",a)}function buildLaboTypeChart(f,e){var a=(getNbOf(f,e,"isStatus=waiting,accepted,assigned,completed,running,archived&isOwner=public"))[0].projects_count;var d=(getNbOf(f,e,"isStatus=waiting,accepted,assigned,completed,running,archived&isOwner=private"))[0].projects_count;var b=(getNbOf(f,e,"isStatus=waiting,accepted,assigned,completed,running,archived&isOwner=public_private"))[0].projects_count;var c=[{name:"Laboratory",colorByPoint:true,data:[{name:"Private",y:d},{name:"Public",y:a},{name:"Public / Private",y:b}]}];buildGenericPie("#container-pie-laboratory"," project's laboratories profiles ",c)}function buildCopartnerChart(g,f){var e=getNbOf(g,f,"isStatus=waiting,accepted,assigned,completed,running,archived&group=copartner")[0];var b=e.can_be_fwd;var a=e.can_not_be_fwd;var d=e.undef;var c=[{name:"Forward",colorByPoint:true,data:[{name:"Can be Fwd",y:b},{name:"Can't be Fwd",y:a},{name:"Undefinded",y:d}]}];buildGenericPie("#container-pie-copartner"," can be forwarded to Copartner ",c)}function buildDemandsChart(f,g){var a=getNbOf(f,g,"isStatus=waiting,accepted,assigned,completed,running,archived&group=type")[0];var j=a.dt__eqprov;var b=a.dt__catallo;var e=a.dt__feastu;var i=a.dt__train;var h=a.dt__data_proc;var d=a.dt__other;var c=[{name:"Demands",colorByPoint:true,data:[{name:"Equipment provisioning",y:j},{name:"Catalog allowance - lab routine",y:b},{name:"feasibility study - R & D",y:e},{name:"Training",y:i},{name:"Data processing",y:h},{name:"Other",y:d}]}];buildGenericPie("#container-pie-demand"," Demand type ",c)}function buildTargetedChart(g,f){var e=getNbOf(g,f,"isStatus=waiting,accepted,assigned,completed,running,archived&group=targeted")[0];var c=e.is_targeted;var d=e.is_NOT_targeted;var b=e.undef;var a=[{name:"Targeted",colorByPoint:true,data:[{name:"targeted",y:c},{name:"untargeted",y:d},{name:"undefined",y:b}]}];buildGenericPie("#container-pie-targeted"," Targeted ",a)}function buildSampleNbChart(h,i){var a=getNbOf(h,i,"isStatus=waiting,accepted,assigned,completed,running,archived&group=sample_number")[0];var d=a.less_50;var b=a["51_to_100"];var c=a["101_to_500"];var e=a.more_501;var g=a.undef;var f=[{name:"sampleNb",colorByPoint:true,data:[{name:"50 or less",y:d},{name:"51  to 100",y:b},{name:"101 to 500",y:c},{name:"more than 501",y:e},{name:"undefined",y:g}]}];buildGenericPie("#container-pie-sampleNb"," Sample Number ",f)}function buildFinancialChart(h,g){var f=getNbOf(h,g,"isStatus=waiting,accepted,assigned,completed,running,archived&group=financial")[0];var d=f.f__financed;var a=f.f__provisioning;var e=f.f__ownsupply;var b=f.f__notfinanced;var c=[{name:"funding",colorByPoint:true,data:[{name:"financed",y:d},{name:"provisioning",y:a},{name:"on own supply",y:e},{name:"Not financed",y:b}]}];buildGenericPie("#container-pie-funding"," Funding ",c)}function buildThematicChart(e,d){var c=(getNbOf(e,d,"&group=keywords&isStatus=waiting,accepted,assigned,completed,running,archived","projects-statistics"));var b=[];$.each(c,function(g,f){if(f.tw_words!==null){b.push({name:f.tw_words,y:f.projects_count})}});var a=[{name:"Thematic keyword",colorByPoint:true,data:b}];buildGenericPie("#container-pie-thematic"," Project thematic repartition ",a)}function buildSubThematicChart(e,d){var c=(getNbOf(e,d,"&group=subkeywords&isStatus=waiting,accepted,assigned,completed,running,archived","projects-statistics"));var b=[];$.each(c,function(g,f){if(f.tw_words!==null){b.push({name:f.tw_words,y:f.projects_count})}});var a=[{name:"Sub-thematic keyword",colorByPoint:true,data:b}];buildGenericPie("#container-pie-subthematic"," Project sub-thematic repartition ",a)}function getNbOf(f,e,c,b){var d=-1;var a=b;if(b===undefined){a="projects-statistics"}$.ajax({type:"get",url:"ajax/ajax_proxypass.php?verbe=get&resource="+a+"&from="+f+"&to="+e+"&"+c,dataType:"json",async:false,success:function(g){if(!(g.hasOwnProperty("success")&&g.success==false)){d=g}},error:function(g){console.log(g)}});return d}function buildGenericPie(a,c,b){$(a).highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:false,type:"pie"},title:{text:c},tooltip:{pointFormat:"<b>{point.percentage:.2f}%</b> ({point.y})",useHTML:true},plotOptions:{pie:{allowPointSelect:true,cursor:"pointer",dataLabels:{enabled:true,format:"<b>{point.name}</b>: {point.percentage:.1f}% ({point.y})",style:{color:(Highcharts.theme&&Highcharts.theme.contrastTextColor)||"black"},useHTML:true}}},series:b})};