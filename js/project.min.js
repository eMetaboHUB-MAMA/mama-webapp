$(document).ready(function(){if(getUrlParameter("editProject")!==undefined){setTimeout(function(){loadProject(Number(getUrlParameter("editProject")))},250)}if(getUrlParameter("update")=="success"){$("#divSuccess").show()}$(".classiqAnalyze").hide();$(".financedOK").hide();$("input[name=demandType]").change(function(){var b=false;$.each($(".classicDemandListener"),function(){if($(this).is(":checked")){b=true}});if(b){$(".classiqAnalyze").show()}else{$(".classiqAnalyze").hide()}});$("#financialContext").change(function(){var b=false;$.each($(".financed"),function(){if($(this).is(":selected")){b=true}});if(b){$(".financedOK").show()}else{$(".financedOK").hide()}}).change();$("#financialContextBis").change(function(){var b=false;$.each($(".financedOther"),function(){if($(this).is(":selected")){b=true}});if(b){$(".financedOKOther").show()}else{$(".financedOKOther").hide()}}).change();$("#financialContext").change();var a=false;$.each($(".classicDemandListener"),function(){if($(this).is(":checked")){a=true}});if(a){$(".classiqAnalyze").show()}else{$(".classiqAnalyze").hide()}});function capitalizeFirstLetter(a){return a.charAt(0).toUpperCase()+a.slice(1)}function buildKeywords(){var c="get";var b="keywords";var a="&order=asc&deleted=false";$.ajax({type:"get",url:"ajax/ajax_proxypass.php?verbe="+c+"&resource="+b+a,dataType:"json",async:true,success:function(e){if(e.hasOwnProperty("success")&&e.success==false){}else{if(e.length===0){}else{var d="";var f=0;e.sort(compareKeyworks);$.each(e,function(h,g){d+='<span id="cw_'+g.id+'" class="cloud-word label label-default" onclick="cloudWord(this)">'+g.word+"</span>";f++;if(f==4){f=0;d+=" "}else{d+=" "}});$("#targetCloudWords").html(d)}}},error:function(d){console.log(d)}})}function cloudWord(a){if($(a).hasClass("label-default")){$(a).removeClass("label-default");$(a).addClass("label-success")}else{if($(a).hasClass("label-success")){$(a).removeClass("label-success");$(a).addClass("label-default")}else{if($(a).hasClass("label-danger")){return}}}var b=$(".cloud-word.label-success").size();var d=true;if(b<3){$.each($(".cloud-word.label-danger"),function(){$(this).removeClass("label-danger");$(this).addClass("label-default")})}else{$.each($(".cloud-word.label-default"),function(){$(this).removeClass("label-default");$(this).addClass("label-danger")})}try{checkIfFormNewProjectValid()}catch(c){}}function buildSubKeywords(){var c="get";var b="subkeywords";var a="&order=asc&deleted=false";$.ajax({type:"get",url:"ajax/ajax_proxypass.php?verbe="+c+"&resource="+b+a,dataType:"json",async:true,success:function(e){if(e.hasOwnProperty("success")&&e.success==false){}else{if(e.length===0){}else{var d="";var f=0;e.sort(compareKeyworks);$.each(e,function(h,g){d+='<span id="scw_'+g.id+'" class="sub-cloud-word label label-default" onclick="subCloudWord(this)">'+g.word+"</span>";f++;if(f==4){f=0;d+=" "}else{d+=" "}});$("#targetSubCloudWords").html(d)}}},error:function(d){console.log(d)}})}function subCloudWord(a){if($(a).hasClass("label-default")){$(a).removeClass("label-default");$(a).addClass("label-success")}else{if($(a).hasClass("label-success")){$(a).removeClass("label-success");$(a).addClass("label-default")}else{if($(a).hasClass("label-danger")){return}}}var b=$(".sub-cloud-word.label-success").size();var c=true;if(b<5){$.each($(".sub-cloud-word.label-danger"),function(){$(this).removeClass("label-danger");$(this).addClass("label-default")})}else{$.each($(".sub-cloud-word.label-default"),function(){$(this).removeClass("label-default");$(this).addClass("label-danger")})}}function loadProject(a){var c="get";var b="project&projectID="+a;$.ajax({type:"get",url:"ajax/ajax_proxypass.php?verbe="+c+"&resource="+b,dataType:"json",async:true,success:function(e){if(e!=null&&e.hasOwnProperty("success")&&e.success==false){}else{$("#projectMetadata_userFullName").html(e.owner.fullName);$("#projectMetadata_userEmail").html(e.owner.email);$("#projectMetadata_createdOn").html(convertJsonDateToHumanReadable(e.created.date)+".");if(e.updated==null){$("#projectMetadata_updatedOn").hide();$("#editProject_metadata_updatedOn").hide()}else{$("#projectMetadata_updatedOn").html(convertJsonDateToHumanReadable(e.updated.date)+".")}$.each(e,function(i,h){var l="project"+capitalizeFirstLetter(i);var j=null;if($("#"+l).length){j=$("#"+l)}else{if($("#"+i).length){j=$("#"+i)}else{if($("input[name="+i+"]").length){j=$("input[name="+i+"]")}}}if(j!==null){if($(j).is("a")||$(j).is("textarea")){$(j).html(h)}else{if($(j).is("input")){if($(j).is("input[type=text]")||$(j).is("input[type=hidden]")){$(j).val(h)}else{if($(j).is("input[type=checkbox]")){$(j).prop("checked",h)}else{if($(j).is("input[type=radio]")){if(h!==null){if(h){$("#"+i+"TRUE").prop("checked",true)}else{$("#"+i+"FALSE").prop("checked",true)}}}}}}else{if($(j).is("select")){var g=$(j).attr("multiple");if(typeof g!==typeof undefined&&g!==false){if(i=="mthPlatforms"){$.each(h,function(k,m){$("option[value=mth_pf_"+m.id+"]").attr("selected",true)})}}else{$(j).val(h)}}else{}}}}});$.each(e.thematicWords,function(g,h){cloudWord($("#cw_"+h.id))});$.each(e.subThematicWords,function(g,h){subCloudWord($("#scw_"+h.id))});if(e.financialContextIsProjectANR){$("option[value=project_financedANR]").attr("selected",true)}if(e.financialContextIsProjectCompagnyTutorship){$("option[value=project_financedCompanyTutorship]").attr("selected",true)}if(e.financialContextIsProjectInternationalOutsideEU){$("option[value=project_financedInternationalOutsideEU]").attr("selected",true)}if(e.financialContextIsProjectOwnResourcesLaboratory){$("option[value=project_financedOwnResourcesLaboratory]").attr("selected",true)}if(e.financialContextIsProjectEU){$("option[value=project_financedEU]").attr("selected",true)}if(e.financialContextIsProjectFinanced){$("option[value=project_financed]").attr("selected",true)}if(e.financialContextIsProjectInProvisioning){$("option[value=project_inProvisioning]").attr("selected",true)}if(e.financialContextIsProjectNational){$("option[value=project_financedNational]").attr("selected",true)}if(e.financialContextIsProjectNotFinanced){$("option[value=project_notFinanced]").attr("selected",true)}if(e.financialContextIsProjectOnOwnSupply){$("option[value=project_onOwnSupply]").attr("selected",true)}if(e.financialContextIsProjectOther){$("option[value=project_financedOther]").attr("selected",true)}if(e.financialContextIsProjectRegional){$("option[value=project_financedRegional]").attr("selected",true)}if(e.scientificContextFile!==null&&e.scientificContextFile!==""){$("#link-to-upload-file").click();$("#project-scientificContextFile").parent().show();var f='download current file: <a href="'+e.scientificContextFileURL+'" target="_blank">'+e.scientificContextFile+"</a>";$("#project-scientificContextFile").html(f)}if(e.hasOwnProperty("analysisRequestExtraData")&&e.analysisRequestExtraData!=null){var d=e.analysisRequestExtraData;$("#extra_adminContext").val(d.administrativeContext);$("#extra_budget").val(d.budgetConstraint);$("#extra_deadline").val(d.deadline);$("#extra_geoContext").val(d.geographicContext);$("#extra_projectMaturity").val(d.projectMaturity);$("#extra_userNeeds").val(d.syntheticUserNeeds);if(d.knowMTHviaCoworkerOrFriend){$("#extra_hdykm_friend").attr("checked",true)}if(d.knowMTHviaPublication){$("#extra_hdykm_publication").attr("checked",true)}if(d.knowMTHviaSearchEngine){$("#extra_hdykm_searchEngine").attr("checked",true)}if(d.knowMTHviaWebsite){$("#extra_hdykm_website").attr("checked",true)}switch(d.laboType){case"public":$("#extra_laboType_public").attr("checked",true);break;case"private":$("#extra_laboType_private").attr("checked",true);break;case"private/public":$("#extra_laboType_privatepublic").attr("checked",true);break}}$("input[type=checkbox]").change();$("input[type=radio]").change();$("select").change();$("#interestInMthCollaboration").focus()}},error:function(d){console.log(d)}})}function checkUpdateProjectForm(){var b=$("#projectId").val();var g="put";var d="project&projectID="+b;var f="";$.each($("input[type=text]"),function(i,h){f+="&"+$(this).prop("id")+"="+encodeURIComponent($("#"+$(this).prop("id")).val())});$.each($("input[type=checkbox]"),function(i,h){f+="&"+$(this).prop("id")+"="+$("#"+$(this).prop("id")).is(":checked")});$.each($("select"),function(i,h){if($(this).prop("id")!="mthPlatforms"){f+="&"+$(this).prop("id")+"="+$("#"+$(this).prop("id")).val()}});$.each($("textarea"),function(i,h){f+="&"+$(this).prop("id")+"="+encodeURIComponent($("#"+$(this).prop("id")).val())});f+="&targeted="+$("input[name=targeted]:checked").val();f+="&copartner="+$("input[name=canBeForwardedToCoPartner]:checked").val();if($("input[name=laboType]").size()>0){f+="&extra_laboType="+$("input[name=laboType]:checked").val()}var c=[];$.each($(".cloud-word.label-success"),function(){c.push($(this).attr("id").replace("cw_",""))});f+="&cloudWords="+c;var e=[];$.each($(".sub-cloud-word.label-success"),function(){e.push($(this).attr("id").replace("scw_",""))});f+="&subCloudWords="+e;var a=[];$.each($("#mthPlatforms option:selected"),function(){a.push($(this).attr("value").replace("mth_pf_",""))});f+="&mthPlatforms="+a;f+="&scientificContextFile="+$("#attachedFile").val();$.ajax({type:"post",url:"ajax/ajax_proxypass.php?verbe="+g+"&resource="+d,dataType:"json",async:true,data:f,success:function(h){if(h.success){location.search="?page=edit-project&editProject="+b+"&update=success"}else{$("#divError").show();if(h.message!==null){$("#divErrorCause").html("<br>cause: "+h.message)}}},error:function(h){console.log(h);$("#divError").show()}});return false}function checkNewProjectForm(){var f="post";var c="project";var e="";$.each($("form input[type=text]"),function(h,g){e+="&"+$(this).prop("id")+"="+encodeURIComponent($("#"+$(this).prop("id")).val())});$.each($("form input[type=checkbox]"),function(h,g){e+="&"+$(this).prop("id")+"="+$("#"+$(this).prop("id")).is(":checked")});$.each($("form select"),function(h,g){if($(this).prop("id")!="mthPlatforms"){e+="&"+$(this).prop("id")+"="+$("#"+$(this).prop("id")).val()}});$.each($("form textarea"),function(h,g){e+="&"+$(this).prop("id")+"="+encodeURIComponent($("#"+$(this).prop("id")).val())});e+="&targeted="+$("input[name=targeted]:checked").val();e+="&copartner="+$("input[name=copartner]:checked").val();var b=[];$.each($(".cloud-word.label-success"),function(){b.push($(this).attr("id").replace("cw_",""))});e+="&cloudWords="+b;var d=[];$.each($(".sub-cloud-word.label-success"),function(){d.push($(this).attr("id").replace("scw_",""))});e+="&subCloudWords="+d;var a=[];$.each($("#mthPlatforms option:selected"),function(){a.push($(this).attr("value").replace("mth_pf_",""))});e+="&mthPlatforms="+a;e+="&scientificContextFile="+$("#attachedFile").val();$.ajax({type:"post",url:"ajax/ajax_proxypass.php?verbe="+f+"&resource="+c,dataType:"json",async:true,data:e,success:function(g){if(g.success){location.search="?page=dashboard"}else{$("#divError").show();if(g.message!==null){$("#divErrorCause").html("<br>cause: "+g.message)}}},error:function(g){console.log(g);$("#divError").show()}});return false}function checkIfFormNewProjectValid(){var a=true;$("div.form-group label sup").css("color","black");$("span.input-group-addon sup").css("color","black");$("#submitNewDAbtn").removeClass("btn-disabled");if($("#projectTitle").val()==""){a=false;$("#projectTitle").parent().find("sup").css("color","red")}if($("#interestInMthCollaboration").val()==""){a=false;$("#interestInMthCollaboration").parent().find("sup").css("color","red")}if($("input[name=demandType]:checked").size()==0){a=false;$("#createProject_content_projectDemandType").parent().find("sup").css("color","red")}if($(".cloud-word.label-success").size()==0){a=false;$("#createProject_content_projectType_thematicCloudWords").parent().find("sup").css("color","red")}if($("#mthPlatforms :checked").size()==0){a=false;$("#createProject_content_project_mthPF").parent().find("sup").css("color","red");console.log(0)}if($("#financialContext :checked").size()==0){a=false;$("#createProject_content_project_financialContext").parent().find("sup").css("color","red")}if(a){$("#submitNewDAbtn").attr("disabled",false)}else{$("#submitNewDAbtn").addClass("btn-disabled");$("#submitNewDAbtn").attr("disabled",true)}return a};