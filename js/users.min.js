var nbUsersInactive=0;var nbUsersNotActivated=0;var nbUsersUsers=0;var nbUsersProjectManager=0;var nbUsersAdmin=0;var nbUsersBlocked=0;var nbUsersTotal=0;var currentUserStatus=null;var currentUserStart=0;var currentUserLimit=20;var currentUserKeyword=null;$(document).ready(function(){loadLang();var a=false;$(".panel.mainBtnOpt").css("cursor","pointer").click(function(){var b=$(this);var c=false;if(!a){c=true}a=true;if(c){document.location=($(b).find("a").attr("href"))}a=false});if(getUrlParameter("status")!==undefined&&getUrlParameter("status")!="null"){currentUserStatus=getUrlParameter("status");$("#search-users-filter-status").html($("#aUser_"+currentUserStatus).html())}if(getUrlParameter("keyword")!==undefined){currentUserKeyword=getUrlParameter("keyword");$("#usersSearchFilter").val(currentUserKeyword)}if(currentUserKeyword!=null||currentUserStatus!=null){$("#link-users-manage").click()}if(getUrlParameter("start")!==undefined){currentUserStart=getUrlParameter("start")}if(getUrlParameter("limit")!==undefined){currentUserLimit=getUrlParameter("limit")}loadUsersStats();if(document.location.toString().indexOf("users")>-1){$("#users-full-list-container").empty();$.get("templates/users-full-list-template-"+lang+".html",function(b){$("body").append(b);if(currentUserStatus==null){currentUserStatus=""}loadUsersList(currentUserStart,currentUserLimit,currentUserStatus)});$("#events-light-list-container").empty();$.get("templates/events-light-list-template-"+lang+".html",function(b){$("body").append(b);loadEventsList(0,10,"users")});$("#usersSearchFilter").bind("keypress",function(c){var b=c.keyCode||c.which;if(b==13){searchUsers()}})}});function loadUsersStats(a){var d="get";var c="users-stats";var b="";if(currentUserKeyword!=null){b+="&keywords="+encodeURIComponent(currentUserKeyword)}$.ajax({type:"get",url:"ajax/ajax_proxypass.php?verbe="+d+"&resource="+c+b,dataType:"json",async:true,success:function(e){if(e.hasOwnProperty("success")&&e.success==false){}else{nbUsersInactive=e.usersInactive;nbUsersNotActivated=e.usersNotActivated;nbUsersUsers=e.usersUsers;nbUsersProjectManager=e.usersProjectManager;nbUsersAdmin=e.usersAdmin;nbUsersBlocked=e.usersBlocked;nbUsersTotal=nbUsersInactive+nbUsersNotActivated+nbUsersUsers+nbUsersProjectManager+nbUsersAdmin+nbUsersBlocked;buildUsersChart();$(".panel-warning.panel-users").find(".huge").html(nbUsersNotActivated);$(".panel-green.panel-users").find(".huge").html(nbUsersUsers);$(".panel-info.panel-users").find(".huge").html(nbUsersProjectManager);$(".panel-primary.panel-users").find(".huge").html(nbUsersAdmin);$(".panel-red.panel-users").find(".huge").html(nbUsersBlocked);$(".panel-lightGray.panel-users").find(".huge").html(nbUsersInactive)}},error:function(e){console.log(e)}})}function loadUsersList(f,b,a){$("#users-full-list-container").empty();var e="get";var d="users";var c="&start="+f+"&limit="+b;if(a!==undefined&&a!==null){c+="&status="+a}if(currentUserKeyword!=null){c+="&keywords="+encodeURIComponent(currentUserKeyword)}c+="&order=desc";$.ajax({type:"get",url:"ajax/ajax_proxypass.php?verbe="+e+"&resource="+d+c,dataType:"json",async:true,success:function(h){if(h.hasOwnProperty("success")&&h.success==false){}else{if(h.length===0){$("#noUsersDiv").show();$("#tableListUsers").hide()}else{$("#noUsersDiv").hide();$("#tableListUsers").show();$.each(h,function(){if(this.email==null){return}var j=md5(this.email.toLowerCase());var i=("https://secure.gravatar.com/avatar/"+j+"?s=50&d=identicon");this["avatar"]=i;$("#noUsersDiv").hide();this["createdLocalDate"]=convertJsonDateToHumanReadable(this.created.date);if(this.updated!=null){this["updatedLocalDate"]=convertJsonDateToHumanReadable(this.updated.date)}this["userStatus"]="";this["userStatusSelectAdmin"]="";this["userStatusSelectProjectManager"]="";this["userStatusSelectUser"]="";this["userStatusSelectBlocked"]="";this["userStatusSelectNotValidated"]="";this["userStatusSelectInactive"]="";this["updateUserDisabled"]="";switch(this.status){case"active":switch(this.right){case"admin":this["userStatus"]="primary";this["userStatusSelectAdmin"]="selected";break;case"project_manager":this["userStatus"]="info";this["userStatusSelectProjectManager"]="selected";break;case"user":default:this["userStatus"]="success";this["userStatusSelectUser"]="selected";break}break;case"inactive":this["userStatus"]="lightGray";this["userStatusSelectInactive"]="selected";this["updateUserDisabled"]="disabled";break;case"blocked":this["userStatus"]="danger";this["userStatusSelectBlocked"]="selected";break;case"not_validated":default:this["userStatus"]="warning";this["userStatusSelectNotValidated"]="selected";break}});$("#users-full-list-template").tmpl(h).appendTo("#users-full-list-container");var g=nbUsersTotal;if(a=="not_validated"){g=nbUsersNotActivated}else{if(a=="user"){g=nbUsersUsers}else{if(a=="projects_manager"){g=nbUsersProjectManager}else{if(a=="admin"){g=nbUsersAdmin}else{if(a=="blocked"){g=nbUsersBlocked}else{if(a=="inactive"){g=nbUsersInactive}}}}}}if(g>b){buildPagination(f,b,a,"usersPagination","loadUsersList",g)}}}},error:function(g){console.log(g)}})}function loadEventsList(f,a,b){var e="get";var d="events";var c="&start="+f+"&limit="+a;if(b!==undefined){c+="&filter="+b}c+="&order=desc";$.ajax({type:"get",url:"ajax/ajax_proxypass.php?verbe="+e+"&resource="+d+c,dataType:"json",async:true,success:function(h){if(h.hasOwnProperty("success")&&h.success==false){}else{if(h.length===0){$("#showMoreEventsBtn").hide()}else{if(h.length<a){$("#showMoreEventsBtn").hide()}$("#noEventToShow").hide();var g=new Date();$.each(h,function(j,i){i=eventStatUpdate(i,g)});$("#events-light-list-template").tmpl(h).appendTo("#events-light-list-container");$('[data-toggle="tooltip"]').tooltip();resizeEventsElements()}}},error:function(g){console.log(g)}})}var lastEventStart=0;var lastEventLimit=10;showMoreUsersEvents=function(){lastEventStart+=lastEventLimit;loadEventsList(lastEventStart,lastEventLimit,"users")};updateUserStatusRight=function(b,c){var a=$(c).val();var f="put";var d="user-right";var e="";e+="&statusRight="+a;$.ajax({type:"post",url:"ajax/ajax_proxypass.php?verbe="+f+"&resource="+d+"&userID="+b,dataType:"json",async:true,data:e,success:function(g){if(g.success){var h="lightGray";if(a=="blocked"){h="danger"}else{if(a=="user"){h="success"}else{if(a=="project_manager"){h="info"}else{if(a=="admin"){h="primary"}}}}$("#tr_user_"+b).attr("class",h)}else{alert("[error] sorry could not upsate user status / rights")}},error:function(g){console.log(g);alert("[error] sorry could not upsate user status / rights")}})};reloadUsersPage=function(a){var b="?page=users";if(a!==undefined){b+="&status="+a}else{if(currentUserStatus!==null){b+="&status="+currentUserStatus}}if($("#usersSearchFilter").val().trim()!=""){b+="&keyword="+$("#usersSearchFilter").val().trim()}document.location=b};searchUsers=function(){reloadUsersPage(currentUserStatus)};