$(function(){var d;var c;var e=0;var b=0;var f=0;var a=0;$(document).ready(function(){Highcharts.setOptions({global:{useUTC:false}});$("#container-update").highcharts({chart:{type:"spline",animation:Highcharts.svg,events:{load:function(){d=this.series[0];serieCpuLoad5=this.series[1];serieCpuLoad15=this.series[2];c=this.series[3];setInterval(function(){var g=(new Date()).getTime();var i="get";var h="server-load";$.ajax({type:"get",url:"ajax/ajax_proxypass.php?verbe="+i+"&resource="+h,dataType:"json",async:true,data:"",success:function(j){c.addPoint([g,j.ram],true,true);d.addPoint([g,j["cpu-1-min"]],true,true);serieCpuLoad5.addPoint([g,j["cpu-5-min"]],true,true);serieCpuLoad15.addPoint([g,j["cpu-15-min"]],true,true)},error:function(j){console.log(j)}})},1000)}}},title:{text:"Server status"},xAxis:[{type:"datetime",tickPixelInterval:120}],yAxis:[{min:0,title:{text:"CPU Usage (%)"},gridLineWidth:0,opposite:true,plotLines:[{value:0,width:1,color:"#808080"}]},{min:0,max:100,title:{text:"RAM Usage (%)"},gridLineWidth:0,plotLines:[{value:0,width:1,color:"#808080"}]}],tooltip:{formatter:function(){return"<b>"+this.series.name+"</b><br/>"+Highcharts.dateFormat("%Y-%m-%d %H:%M:%S",this.x)+"<br/>"+Highcharts.numberFormat(this.y,2)+"%"}},legend:{enabled:true},exporting:{enabled:false},series:[{name:"CPU load <small>(last minute)</small>",yAxis:0,data:(function(){var h=[],j=(new Date()).getTime(),g;for(g=-500;g<=0;g+=1){h.push({x:j+g*1000,y:0})}return h}())},{name:"CPU load <small>(last 5 minutes)</small>",yAxis:0,data:(function(){var h=[],j=(new Date()).getTime(),g;for(g=-500;g<=0;g+=1){h.push({x:j+g*1000,y:0})}return h}())},{name:"CPU load <small>(last 15 minutes)</small>",yAxis:0,data:(function(){var h=[],j=(new Date()).getTime(),g;for(g=-500;g<=0;g+=1){h.push({x:j+g*1000,y:0})}return h}())},{name:"Memory usage",yAxis:1,data:(function(){var h=[],j=(new Date()).getTime(),g;for(g=-500;g<=0;g+=1){h.push({x:j+g*1000,y:0})}return h}())}]})})});var keywordTemplateLoaded=false;var subKeywordTemplateLoaded=false;var mthPlatformTemplateLoaded=false;loadKeywords=function(){if(!keywordTemplateLoaded){$.get("templates/keywords-light-list-template.html",function(d){$("body").append(d);keywordTemplateLoaded=true;loadKeywords()})}else{$("#keywords-light-list-container").empty();var c="get";var b="keywords";var a="&order=asc";$.ajax({type:"get",url:"ajax/ajax_proxypass.php?verbe="+c+"&resource="+b+a,dataType:"json",async:true,success:function(d){if(d.hasOwnProperty("success")&&d.success==false){}else{if(d.length===0){$("#noKeywordsToShow").show()}else{d.sort(compareKeyworks);$("#noKeywordsToShow").hide();$("#keywords-light-list-template").tmpl(d).appendTo("#keywords-light-list-container")}}},error:function(d){console.log(d)}})}};loadKeywords();loadSubKeywords=function(){if(!keywordTemplateLoaded){$.get("templates/subkeywords-light-list-template.html",function(d){$("body").append(d);subKeywordTemplateLoaded=true;loadSubKeywords()})}else{$("#subkeywords-light-list-container").empty();var c="get";var b="subkeywords";var a="&order=asc";$.ajax({type:"get",url:"ajax/ajax_proxypass.php?verbe="+c+"&resource="+b+a,dataType:"json",async:true,success:function(d){if(d.hasOwnProperty("success")&&d.success==false){}else{if(d.length===0){$("#noSubKeywordsToShow").show()}else{d.sort(compareKeyworks);$("#noSubKeywordsToShow").hide();$("#subkeywords-light-list-template").tmpl(d).appendTo("#subkeywords-light-list-container")}}},error:function(d){console.log(d)}})}};loadSubKeywords();loadMTHPlatforms=function(){if(!mthPlatformTemplateLoaded){$.get("templates/mthPlatforms-light-list-template.html",function(d){$("body").append(d);mthPlatformTemplateLoaded=true;loadMTHPlatforms()})}else{$("#mthPlatforms-light-list-container").empty();var c="get";var b="mth-platforms";var a="&order=asc";$.ajax({type:"get",url:"ajax/ajax_proxypass.php?verbe="+c+"&resource="+b+a,dataType:"json",async:true,success:function(d){if(d.hasOwnProperty("success")&&d.success==false){}else{if(d.length===0){$("#noMTHPlatformsToShow").show()}else{$("#noMTHPlatformsToShow").hide();$("#mthPlatforms-light-list-template").tmpl(d).appendTo("#mthPlatforms-light-list-container")}}},error:function(d){console.log(d)}})}};loadMTHPlatforms();addNewKeyword=function(){if($("#newKeyword").val()==""){return false}var b="keyword="+$("#newKeyword").val();var c="post";var a="keyword";$.ajax({type:"post",url:"ajax/ajax_proxypass.php?verbe="+c+"&resource="+a,dataType:"json",async:true,data:b,success:function(d){if(d.success){loadKeywords();$("#newKeyword").val("")}else{alert("[error] sorry, could not add keyword.")}},error:function(d){console.log(d);alert("[error] sorry, could not add keyword.")}});return false};$("#newKeyword").bind("keypress",function(b){var a=b.keyCode||b.which;if(a==13){addNewKeyword()}});addNewSubKeyword=function(){if($("#newSubKeyword").val()==""){return false}var b="keyword="+$("#newSubKeyword").val();var c="post";var a="subkeyword";$.ajax({type:"post",url:"ajax/ajax_proxypass.php?verbe="+c+"&resource="+a,dataType:"json",async:true,data:b,success:function(d){if(d.success){loadSubKeywords();$("#newSubKeyword").val("")}else{alert("[error] sorry, could not add subkeyword.")}},error:function(d){console.log(d);alert("[error] sorry, could not add subkeyword.")}});return false};$("#newSubKeyword").bind("keypress",function(b){var a=b.keyCode||b.which;if(a==13){addNewSubKeyword()}});addNewMTHPlatform=function(){var b="mthPlatform="+$("#newMTHPlatform").val();var c="post";var a="mth-platform";$.ajax({type:"post",url:"ajax/ajax_proxypass.php?verbe="+c+"&resource="+a,dataType:"json",async:true,data:b,success:function(d){if(d.success){loadMTHPlatforms();$("#newMTHPlatform").val("")}else{alert("[error] sorry, could not add MTH platform.")}},error:function(d){console.log(d);alert("[error] sorry, could not add MTH platform.")}});return false};$("#newMTHPlatform").bind("keypress",function(b){var a=b.keyCode||b.which;if(a==13){addNewMTHPlatform()}});var saveAdminObject=function(){};$("#newName").bind("keypress",function(b){var a=b.keyCode||b.which;if(a==13){saveAdminObject()}});editKeyword=function(b,a){$("#adminEntity").html(a);$("#newName").val("");$("#newName").attr("placeholder",""+a);$("#adminEditEntityModal").modal("show");setTimeout(function(){$("#newName").focus()},250);saveAdminObject=function(){keyword=$("#newName").val();if(keyword===null){return false}var e="keyword="+keyword;var f="put";var c="keyword";var d="keywordID="+b;$.ajax({type:"post",url:"ajax/ajax_proxypass.php?verbe="+f+"&resource="+c+"&"+d,dataType:"json",async:true,data:e,success:function(g){if(g.success){loadKeywords();return true}else{alert("[error] sorry, could not edit keyword.")}},error:function(g){console.log(g);alert("[error] sorry, could not edit keyword.")}});$("#adminEditEntityModal").modal("hide");saveAdminObject=function(){};return false}};editSubKeyword=function(b,a){$("#adminEntity").html(a);$("#newName").val("");$("#newName").attr("placeholder",""+a);$("#adminEditEntityModal").modal("show");setTimeout(function(){$("#newName").focus()},250);saveAdminObject=function(){keyword=$("#newName").val();if(keyword===null){return false}var e="keyword="+keyword;var f="put";var c="subkeyword";var d="keywordID="+b;$.ajax({type:"post",url:"ajax/ajax_proxypass.php?verbe="+f+"&resource="+c+"&"+d,dataType:"json",async:true,data:e,success:function(g){if(g.success){loadSubKeywords();return true}else{alert("[error] sorry, could not edit subkeyword.")}},error:function(g){console.log(g);alert("[error] sorry, could not edit subkeyword.")}});$("#adminEditEntityModal").modal("hide");saveAdminObject=function(){};return false}};editMTHPlatform=function(b,a){$("#adminEntity").html(a);$("#newName").val("");$("#newName").attr("placeholder",""+a);$("#adminEditEntityModal").modal("show");setTimeout(function(){$("#newName").focus()},250);saveAdminObject=function(){mthPlatform=$("#newName").val();if(mthPlatform===null){return false}var e="mthPlatform="+mthPlatform;var f="put";var c="mth-platform";var d="mthPlatformID="+b;$.ajax({type:"post",url:"ajax/ajax_proxypass.php?verbe="+f+"&resource="+c+"&"+d,dataType:"json",async:true,data:e,success:function(g){if(g.success){loadMTHPlatforms();return true}else{alert("[error] sorry, could not edit MTH Platform.")}},error:function(g){console.log(g);alert("[error] sorry, could not edit MTH Platform.")}});$("#adminEditEntityModal").modal("hide");saveAdminObject=function(){};return false}};restoreKeyword=function(e){var c="deleted=false";var d="put";var a="keyword";var b="keywordID="+e;$.ajax({type:"post",url:"ajax/ajax_proxypass.php?verbe="+d+"&resource="+a+"&"+b,dataType:"json",async:true,data:c,success:function(f){if(f.success){loadKeywords();return true}else{alert("[error] sorry, could not edit keyword.")}},error:function(f){console.log(f);alert("[error] sorry, could not edit keyword.")}});return false};deleteKeyword=function(e){var c="deleted=true";var d="put";var a="keyword";var b="keywordID="+e;$.ajax({type:"post",url:"ajax/ajax_proxypass.php?verbe="+d+"&resource="+a+"&"+b,dataType:"json",async:true,data:c,success:function(f){if(f.success){loadKeywords();return true}else{alert("[error] sorry, could not edit keyword.")}},error:function(f){console.log(f);alert("[error] sorry, could not edit keyword.")}});return false};restoreSubKeyword=function(e){var c="deleted=false";var d="put";var a="subkeyword";var b="keywordID="+e;$.ajax({type:"post",url:"ajax/ajax_proxypass.php?verbe="+d+"&resource="+a+"&"+b,dataType:"json",async:true,data:c,success:function(f){if(f.success){loadSubKeywords();return true}else{alert("[error] sorry, could not edit subkeyword.")}},error:function(f){console.log(f);alert("[error] sorry, could not edit subkeyword.")}});return false};deleteSubKeyword=function(e){var c="deleted=true";var d="put";var a="subkeyword";var b="keywordID="+e;$.ajax({type:"post",url:"ajax/ajax_proxypass.php?verbe="+d+"&resource="+a+"&"+b,dataType:"json",async:true,data:c,success:function(f){if(f.success){loadSubKeywords();return true}else{alert("[error] sorry, could not edit subkeyword.")}},error:function(f){console.log(f);alert("[error] sorry, could not edit subkeyword.")}});return false};var logStep=20;function showLogs(f,e,a){f=Number(f);e=Number(e);var b="admin/show-logs/"+a;var c="from="+f+"&to="+e;var d="get";if(f===1){$("#logContent").html("")}$(".btn-showlog").attr("disabled",false);$.ajax({type:"get",url:"ajax/ajax_proxypass.php?verbe="+d+"&resource="+b,dataType:"text",async:true,data:c,success:function(g){$("#logContent").html($("#logContent").html()+g.replace(new RegExp("\n","g"),"\n<br />"));$("#adminShowLogsModal").modal("show");if(g.split("\n").length<logStep){$("#btnMoreLogs").attr("disabled",true)}else{$("#btnMoreLogs").attr("disabled",false);$("#btnMoreLogs").attr("onclick","showLogs ("+(f+logStep)+", "+(e+logStep)+", '"+a+"')")}if(a=="daily-mailler"){$("#showLogDailyMaillerBtn").attr("disabled",true)}if(a=="weekly-mailler"){$("#showLogweeklyMaillerBtn").attr("disabled",true)}if(a=="monthly-users_inactiver"){$("#showLogMontlhyUsersInactiverBtn").attr("disabled",true)}},error:function(g){console.log(g);alert("[error] sorry, could show logs")}});return true}function cleanTokens(){$("#btnCleanTokens").removeClass("btn-primary").addClass("btn-warning");$("#btnCleanTokens").html('<i class="fa fa-spinner fa-spin fa-fw"></i>');var b="nbHours="+$("#cleanTokenNbHours").val();var c="delete";var a="admin/clean-tokens";$.ajax({type:"post",url:"ajax/ajax_proxypass.php?verbe="+c+"&resource="+a,dataType:"json",async:true,data:b,success:function(d){if(d.success){$("#btnCleanTokens").removeClass("btn-warning").addClass("btn-success");$("#btnCleanTokens").html('<i class="fa fa-check-circle"></i>');return true}else{$("#btnCleanTokens").removeClass("btn-warning").addClass("btn-danger");$("#btnCleanTokens").html('<i class="fa fa-times-circle"></i>');return false}},error:function(d){console.log(d);$("#btnCleanTokens").removeClass("btn-warning").addClass("btn-danger");$("#btnCleanTokens").html('<i class="fa fa-times-circle"></i>');return false}});return false}function archiveProjects(){$("#btnArchiveProjects").removeClass("btn-primary").addClass("btn-warning");$("#btnArchiveProjects").html('<i class="fa fa-spinner fa-spin fa-fw"></i>');var b="nbYears="+$("#archiveProjectNbYears").val();var c="put";var a="admin/archive-projects";$.ajax({type:"post",url:"ajax/ajax_proxypass.php?verbe="+c+"&resource="+a,dataType:"json",async:true,data:b,success:function(d){if(d.success){$("#btnArchiveProjects").removeClass("btn-warning").addClass("btn-success");$("#btnArchiveProjects").html('<i class="fa fa-check-circle"></i>');return true}else{$("#btnArchiveProjects").removeClass("btn-warning").addClass("btn-danger");$("#btnArchiveProjects").html('<i class="fa fa-times-circle"></i>');return false}},error:function(d){console.log(d);$("#btnArchiveProjects").removeClass("btn-warning").addClass("btn-danger");$("#btnArchiveProjects").html('<i class="fa fa-times-circle"></i>');return false}});return false}function inactiveUsers(){$("#btnInactiveUsers").removeClass("btn-primary").addClass("btn-warning");$("#btnInactiveUsers").html('<i class="fa fa-spinner fa-spin fa-fw"></i>');var b="nbWeeks="+$("#inactiveUsersNbWeeks").val();var c="put";var a="admin/inactive-users";$.ajax({type:"post",url:"ajax/ajax_proxypass.php?verbe="+c+"&resource="+a,dataType:"json",async:true,data:b,success:function(d){if(d.success){$("#btnInactiveUsers").removeClass("btn-warning").addClass("btn-success");$("#btnInactiveUsers").html('<i class="fa fa-check-circle"></i>');return true}else{$("#btnInactiveUsers").removeClass("btn-warning").addClass("btn-danger");$("#btnInactiveUsers").html('<i class="fa fa-times-circle"></i>');return false}},error:function(d){console.log(d);$("#btnInactiveUsers").removeClass("btn-warning").addClass("btn-danger");$("#btnInactiveUsers").html('<i class="fa fa-times-circle"></i>');return false}});return false}function cleanUploaded(){$("#cleanUploadFiles i").removeClass("fa-eraser").addClass("fa-spin").addClass("fa-spinner");$("#cleanUploadFiles").attr("disabled",true);$("#cleanUploadFiles").removeClass("btn-primary").addClass("btn-warning");var b="put";var a="admin/clean-uploaded-files";$.ajax({type:"post",url:"ajax/ajax_proxypass.php?verbe="+b+"&resource="+a,dataType:"json",async:true,success:function(c){if(c.success){$("#cleanUploadedMessage").html("<small>clean "+c["nb-deleted"]+" file(s)!</small>");$("#cleanUploadFiles i").removeClass("fa-spin").removeClass("fa-spinner").addClass("fa-check-circle");$("#cleanUploadFiles").removeClass("btn-warning").addClass("btn-success");return true}else{$("#cleanUploadFiles i").removeClass("fa-spin").removeClass("fa-spinner").addClass("fa-times-circle");$("#cleanUploadFiles").removeClass("btn-warning").addClass("btn-danger");return false}},error:function(c){console.log(c);$("#cleanUploadFiles i").removeClass("fa-spin").removeClass("fa-spinner").addClass("fa-times-circle");$("#cleanUploadFiles").removeClass("btn-warning").addClass("btn-danger");return false}});return false};