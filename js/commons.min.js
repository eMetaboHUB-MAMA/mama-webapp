function getStandardizedDateFromJson(e){var c=e.replace(".000000","").split(" ");var d=(c[0]).split("-");var a=(c[1]).split(":");var g=Number(d[0]);var f=Number(d[1]);var h=Number(d[2]);var j=Number(a[0]);var b=Number(a[1]);var i=Number(a[2]);return new Date(Date.UTC(g,(f-1),h,j,b,i))}function getHumanReadableDate(a){return a.toISOString().slice(0,19).replace(/-/g,"-").replace(/T/g," ")}function getHumanReadableDateShort(a){return a.toISOString().slice(0,19).replace(/-/g,"-").replace(/T/g," ").split(" ")[0]}function convertJsonDateToHumanReadable(a){var b=getStandardizedDateFromJson(a);return getHumanReadableDate(new Date(Date.UTC(b.getFullYear(),b.getMonth(),b.getDate(),b.getHours(),b.getMinutes(),b.getSeconds())))}function convertJsonDateToHumanReadableShort(a){var b=getStandardizedDateFromJson(a);return getHumanReadableDateShort(new Date(Date.UTC(b.getFullYear(),b.getMonth(),b.getDate(),b.getHours(),b.getMinutes(),b.getSeconds())))}function eventStatUpdate(d,f){var e=getStandardizedDateFromJson(d.created.date);var c=DateDiff.inSeconds(e,f);var a=DateDiff.inMinutes(e,f);if(c>=60){c=c-(a*60)}var b=DateDiff.inHours(e,f);if(a>=60){a=a-(b*60)}d.nbSecondsAgo=c;d.nbMinutsAgo=a;d.nbHoursAgo=b;d.nbDaysAgo=DateDiff.inDays(e,f);d.nbWeeksAgo=DateDiff.inWeeks(e,f);d.nbMonthsAgo=DateDiff.inMonths(e,f);d.nbYearsAgo=DateDiff.inYears(e,f);d.toogleDate=convertJsonDateToHumanReadable(d.created.date);return d}function buildPagination(b,e,c,k,d,a){$("#"+k).empty();var l=a;var g=parseInt((l/e),10)+1;var i=parseInt((b/e),10)+1;if(b==0){$("#"+k).append('<li class="disabled"><a href="#">&laquo;</a></li>')}else{$("#"+k).append('<li><a href="#" onclick="'+d+"(0, "+e+",'"+c+"');\">&laquo;</a></li>")}if((i)>3){$("#"+k).append('<li class="disabled"><a href="#">&hellip;</a></li>')}if(i>2){prev=(i-3)*e;$("#"+k).append('<li><a href="#" onclick="'+d+"("+prev+", "+e+",'"+c+"');\">"+(i-2)+"</a></li>")}if(i>1){prev=(i-2)*e;$("#"+k).append('<li><a href="#" onclick="'+d+"("+prev+", "+e+",'"+c+"');\">"+(i-1)+"</a></li>")}$("#"+k).append('<li class="active"><a href="#">'+i+"</a></li>");if((i+0)<g){prev=(i)*e;$("#"+k).append('<li><a href="#" onclick="'+d+"("+prev+", "+e+",'"+c+"');\">"+(i+1)+"</a></li>")}if((i+1)<g){prev=(i+1)*e;$("#"+k).append('<li><a href="#" onclick="'+d+"("+prev+", "+e+",'"+c+"');\">"+(i+2)+"</a></li>")}if((i+2)<g){$("#"+k).append('<li class="disabled"><a href="#">&hellip;</a></li>')}if((i+1)>=g){$("#"+k).append('<li class="disabled"><a href="#">&raquo;</a></li>')}else{var h=i+2;var j=(h)*e;var f=(l-e);while(f>j){h++;j=(h)*e}j=(h)*e;$("#"+k).append('<li><a href="#" onclick="'+d+"("+j+", "+e+",'"+c+"');\">&raquo;</a></li>")}}var DateDiff={inSeconds:function(d,c){var a=c.getTime();var b=d.getTime();return parseInt((a-b)/(1000))},inMinutes:function(d,c){var a=c.getTime();var b=d.getTime();return parseInt((a-b)/(60*1000))},inHours:function(d,c){var a=c.getTime();var b=d.getTime();return parseInt((a-b)/(3600*1000))},inDays:function(d,c){var a=c.getTime();var b=d.getTime();return parseInt((a-b)/(24*3600*1000))},inWeeks:function(d,c){var a=c.getTime();var b=d.getTime();return parseInt((a-b)/(24*3600*1000*7))},inMonths:function(f,d){var a=f.getFullYear();var c=d.getFullYear();var b=f.getMonth();var e=d.getMonth();return(e+12*c)-(b+12*a)},inYears:function(b,a){return a.getFullYear()-b.getFullYear()}};function getAllProjectsManagers(){var a=[];var c="get";var b="projects-managers";$.ajax({type:"get",url:"ajax/ajax_proxypass.php?verbe="+c+"&resource="+b,dataType:"json",async:false,success:function(f){a=f;try{a.sort(compareUserFullname)}catch(d){}},error:function(d){console.log(d)}});return a}function compareUserFullname(d,c){if(d.fullName<c.fullName){return -1}if(d.fullName>c.fullName){return 1}return 0}function writeMessageToUserAboutProject(b,a,d,c){var f;var h=null;if(d!==undefined){f=$($("#projectTr"+a+" td")[d]).text().trim();h=$($("#projectTr"+a+" td")[1]).html();if(c!==undefined){var g=$(c);console.log(g);f=$($(g)).text().trim();console.log(f);h=$($(g).parent().parent().find("a.pjTitle")).html()}}else{f=$($("#projectA"+a+"")).text().trim();h=$($("#projectTr"+a+" td")[0]).html()}if(h!=""){h=window._about_project_start+h+window._about_project_end}$("#writeMessageToSPAN").html(f);$("#divWriteMessage").empty().append('<textarea id="writeMessage" class="form-control wysihtml5" rows="3">'+h+"</textarea>");$("#writeMessage").wysihtml5({"font-styles":false,emphasis:true,lists:false,html:false,link:false,image:false,color:false,blockquote:false});$("a[title='Indent']").remove();$("a[title='Outdent']").remove();$("a[title='CTRL+S']").remove();setTimeout(function(){$($(".wysihtml5-toolbar")[0]).append('<li class="pull-right"><small id="writeMessageTxtCount"></small></li>');setInterval(function(){$("#writeMessageTxtCount").html(2048-$("#writeMessage").val().length)},100)},250);$("#writeMessageBtn").attr("onclick","postMessageToUser("+b+");");$("#writeMessageModal").modal("show");setTimeout(function(){$("#writeMessage").focus()},200)}function writeMessageToUser(a){var b=$($("#loginUserA"+a+"")).text().trim();$("#writeMessageToSPAN").html(b);$("#divWriteMessage").empty().append('<textarea id="writeMessage" class="form-control wysihtml5" rows="3"></textarea>');$("#writeMessage").wysihtml5({"font-styles":false,emphasis:true,lists:false,html:false,link:false,image:false,color:false,blockquote:false});$("a[title='Indent']").remove();$("a[title='Outdent']").remove();$("a[title='CTRL+S']").remove();setTimeout(function(){$($(".wysihtml5-toolbar")[0]).append('<li class="pull-right"><small id="writeMessageTxtCount"></small></li>');setInterval(function(){$("#writeMessageTxtCount").html(2048-$("#writeMessage").val().length)},100)},250);$("#writeMessageBtn").attr("onclick","postMessageToUser("+a+");");$("#writeMessageModal").modal("show");setTimeout(function(){$("#writeMessage").focus()},200)}function postMessageToUser(a){var b=$("#writeMessage").val();var d="post";var c="message";if(b==""){return false}$.ajax({type:"post",url:"ajax/ajax_proxypass.php?verbe="+d+"&resource="+c,dataType:"json",data:"userID="+a+"&message="+encodeURI(b),async:true,success:function(){$("#writeMessageModal").modal("hide")},error:function(e){console.log(e)}})}function postMessageToProject(a){var b=$("#writeProjectMessage").val();var d="post";var c="message";if(b==""){return false}$.ajax({type:"post",url:"ajax/ajax_proxypass.php?verbe="+d+"&resource="+c,dataType:"json",data:"projectID="+a+"&message="+encodeURI(b),async:true,success:function(){$("#divWriteProjectMessage").parent().hide();$("#messages-light-list-container").empty();loadProjectMessagesList(0,10,a)},error:function(e){console.log(e)}})}function openMessage(a){$("#projectModal").modal("hide");var c="get";var b="message";$.ajax({type:"get",url:"ajax/ajax_proxypass.php?verbe="+c+"&resource="+b,dataType:"json",data:"messageID="+a,async:true,success:function(d){if((d).hasOwnProperty("success")&&d.success==false){return false}$("#messageModal_replyAllBtn").hide();$("#divReplyMessage").empty().append('<textarea id="replyMessage" class="form-control wysihtml5" rows="3"></textarea>');$(".wysihtml5").wysihtml5({"font-styles":false,emphasis:true,lists:false,html:false,link:false,image:false,color:false,blockquote:false});$("a[title='Indent']").remove();$("a[title='Outdent']").remove();$("a[title='CTRL+S']").remove();setTimeout(function(){$($(".wysihtml5-toolbar")[0]).append('<li class="pull-right"><small id="replyMessageTxtCount"></small></li>');setInterval(function(){$("#replyMessageTxtCount").html(2048-$("#replyMessage").val().length)},100)},250);if(d.fromProject!==null){$("#messageModal_from").html(d.fromProject.title);$("#messageModal_author").html(d.fromProject.title+" - <i>"+convertJsonDateToHumanReadable(d.created.date)+"</i>");$("#messageModal_replyBtn").attr("onclick","replyTo('project', "+d.fromProject.id+")")}else{if(d.fromUser!==null){$("#messageModal_from").html(d.fromUser.fullName);$("#messageModal_author").html(d.fromUser.fullName+" - <i>"+convertJsonDateToHumanReadable(d.created.date)+"</i>");$("#messageModal_replyBtn").attr("onclick","replyTo('user', "+d.fromUser.id+")")}}if(d.toProject!==null){$("#messageModal_to").html(d.toProject.title);$("#messageModal_replyAllBtn").attr("onclick","replyTo('project', "+d.toProject.id+")").show()}else{if(d.toUser!==null){$("#messageModal_to").html(d.toUser.fullName)}}$("#messageModal_message").html(d.message);$("#messageModal_linkToMessage").prop("href","?page=messages&showMessage="+d.id);$("#messageModal").modal("show");$("#messageModal_message_n0_p").hide();if(d.fromUser!=null&&d.toUser!=null){$.ajax({type:"get",url:"ajax/ajax_proxypass.php?verbe=get&resource=messages",dataType:"json",data:"start=0&limit=50&userFilter=sender",async:true,success:function(f){if((f).hasOwnProperty("success")&&d.success==false){return false}else{var e=null;$.each(f,function(h,g){if(g.toUser!==null&&g.toUser.id===d.fromUser.id&&g.id!==d.id){e=g}});if(e!==null&&e.created.date<d.created.date){console.log(e);$("#messageModal_message_n0").html(e.message);$("#messageModal_author_n0").html(e.fromUser.fullName+" - <i>"+convertJsonDateToHumanReadable(e.created.date)+"</i>");$("#messageModal_message_n0_p").show()}}},error:function(e){console.log(e)}})}},error:function(d){console.log(d)}})}function replyTo(a,f){var c=$("#replyMessage").val();var e="post";var d="message";if(c==""){return false}var b="";if(a=="project"){b="projectID="+f}else{if(a=="user"){b="userID="+f}}$.ajax({type:"post",url:"ajax/ajax_proxypass.php?verbe="+e+"&resource="+d,dataType:"json",data:b+"&message="+encodeURI(c),async:true,success:function(){$("#messageModal").modal("hide")},error:function(g){console.log(g)}})}function buildMTHplatforms(){var c="get";var b="mth-platforms";var a="&order=asc&";$.ajax({type:"get",url:"ajax/ajax_proxypass.php?verbe="+c+"&resource="+b+a,dataType:"json",async:true,success:function(d){if(d.hasOwnProperty("success")&&d.success==false){}else{if(d.length===0){}else{$.each(d,function(f,e){$("#mthPlatforms").append('<option value="mth_pf_'+e.id+'">'+e.name+"</option>")});if(typeof filterMthPF!=="undefined"&&filterMthPF){$.each(filterMthPFval.split(","),function(f,e){$("#mthPlatforms option[value="+e+"]").attr("selected","selected")})}}$(".multiselect-mthPlatforms").multiselect({maxHeight:500,numberDisplayed:2,buttonWidth:"150px",onDropdownShow:function(e){window._buildMTHplatforms_cache_before=$("#mthPlatforms").val()+""},onDropdownHide:function(e){if($("#mthPlatforms").val()+""!==window._buildMTHplatforms_cache_before){addRemoveUserFilter("mth_pf",$("#mthPlatforms").val())}},filterPlaceholder:_multiselect_mth_platforms_filterPlaceholder,nonSelectedText:_multiselect_mth_platforms_nonSelectedText,nSelectedText:_multiselect_mth_platforms_nSelectedText,allSelectedText:_multiselect_mth_platforms_allSelectedText})}},error:function(d){console.log(d)}})}function createAppointment(b,a,d,c){$("#appointment2user__USERNAME").html(c);$("#appointment2user__PROJECTNAME").html(a);$("#createAppointmentButton").attr("onclick","saveAppointment ("+b+", "+d+")");$("#divCreateAppointment").empty().append('<textarea id="createAppointment" class="form-control wysihtml5" rows="3"></textarea>');$(".wysihtml5").wysihtml5({"font-styles":false,emphasis:true,lists:false,html:false,link:false,image:false,color:false,blockquote:false});$("a[title='Indent']").remove();$("a[title='Outdent']").remove();$("#listNewAppointment").hide().empty();$("#appointmentModalFix").modal("show")}function addAppointmentDate(){if($("#new-appointment").val()==""){return}$("#listNewAppointment").show();var a='<li class="list-group-item">';a+='<span class="pull-right">';a+='<button type="button" class="btn btn-danger btn-xs" onclick="deleteAppointment(this)">';a+='<span aria-hidden="true"><i class="fa fa-calendar-times-o"></i></span> <span class="sr-only">Cancel</span>';a+="</button>";a+="</span>";a+='<span class="appDateTime">'+$("#new-appointment").val()+"</span>";a+="</li>";$("#new-appointment").val("");$("#listNewAppointment").append(a)}function deleteAppointment(b){var a=$(b);a.parent().parent().remove()}function saveAppointment(a,b){var c=[];var d=$("#createAppointment").val().trim();var e="appointment";var f="post";$.each($(".appDateTime"),function(h,g){c.push(new Date($(g).html()+":00").toISOString().replace(/T/g," ").substring(0,19))});if(d==""){alert("[error] missing message!");return false}if(c.length===0){alert("[error] missing date!");return false}if($("#new-appointment").val()!=""){alert("[warning] you didn't validate the date \""+$("#new-appointment").val()+'"');return false}$.ajax({type:"post",url:"ajax/ajax_proxypass.php?verbe="+f+"&resource="+e,dataType:"json",data:"userID="+b+"&projectID="+a+"&message="+encodeURI(d)+"&dates="+c,async:true,success:function(){$("#appointmentModalFix").modal("hide")},error:function(g){console.log(g)}})}function openAppointment(c){var a="appointment";var b="get";$.ajax({type:"post",url:"ajax/ajax_proxypass.php?verbe="+b+"&resource="+a+"&appointmentID="+c,dataType:"json",async:true,success:function(d){$("#appointmentFromUser__USERNAME").html(d.fromUser.fullName);$("#appointmentFromUser__PROJECTNAME").html(d.project.title);$("#appointmentFromUser__MESSAGE").html(d.message);$("#appointmentFromUser__AUTHOR").html(d.fromUser.fullName+" - <i>"+convertJsonDateToHumanReadable(d.created.date)+"</i>");$("#modalOpenAppointment_listProp").empty();$.each(d.appointmentDatesPropositions,function(g,f){var h="";if(f.appointmentSelected==null){h="list-group-item-info"}else{if(f.appointmentSelected){h="list-group-item-success"}else{h="list-group-item-danger"}}var e='<li id="gui_appointmentProp_'+f.id+'" class="list-group-item '+h+" gui_appointmentProp_"+d.id+'">';e+='<span class="pull-right">';if(d.appointmentDate==null){e+='<button type="button" class="btn btn-success btn-xs" onclick="updateGUIappointment('+f.id+", "+d.id+', true);">';e+='<span aria-hidden="true"><i class="fa fa-calendar-check-o"></i></span> <span class="sr-only">accept</span>';e+="</button>&nbsp;";e+='<button type="button" class="btn btn-danger btn-xs" onclick="updateGUIappointment('+f.id+", "+d.id+', false);">';e+='<span aria-hidden="true"><i class="fa fa-calendar-times-o"></i></span> <span class="sr-only">reject</span>';e+="</button>"}e+="</span>";e+=""+convertJsonDateToHumanReadable(f.date.date).substring(0,16);e+='<input type="hidden" value="'+f.id+'">';e+="</li>";$("#modalOpenAppointment_listProp").append(e)});$("#saveAppointmentButton").hide();if(d.appointmentDate==null){$("#saveAppointmentButton").show();$("#saveAppointmentButton").attr("onclick","putAppointment ("+d.id+")")}$("#saveAppointmentButton").attr("onclick","putAppointment ("+d.id+")");$("#appointmentModalRead").modal("show")},error:function(d){console.log(d)}})}function updateGUIappointment(b,a,c){$("#gui_appointmentProp_"+b).removeClass("list-group-item-success").removeClass("list-group-item-danger").removeClass("list-group-item-info");if(c){$(".gui_appointmentProp_"+a).removeClass("list-group-item-success").removeClass("list-group-item-danger").removeClass("list-group-item-info");$(".gui_appointmentProp_"+a).addClass("list-group-item-danger");$("#gui_appointmentProp_"+b).removeClass("list-group-item-danger").addClass("list-group-item-success")}else{$("#gui_appointmentProp_"+b).addClass("list-group-item-danger");if($(".gui_appointmentProp_"+a+".list-group-item-info").length==1){$($(".gui_appointmentProp_"+a+".list-group-item-info")[0]).removeClass("list-group-item-info").addClass("list-group-item-success")}}}function putAppointment(f){var e=[];var c=[];var a=[];$.each($(".gui_appointmentProp_"+f+".list-group-item-info input[type='hidden']"),function(h,g){e.push(Number($(g).val()))});$.each($(".gui_appointmentProp_"+f+".list-group-item-success input[type='hidden']"),function(h,g){c.push(Number($(g).val()))});$.each($(".gui_appointmentProp_"+f+".list-group-item-danger input[type='hidden']"),function(h,g){a.push(Number($(g).val()))});var b="appointment";var d="put";$.ajax({type:"post",url:"ajax/ajax_proxypass.php?verbe="+d+"&resource="+b+"&appointmentID="+f,dataType:"json",data:"pending="+e+"&accepted="+c+"&rejected="+a,async:true,success:function(g){if("success" in g&&g.success){if(c.length==1){$("#gui_appointmentProp_"+(c[0])+" button").remove();$("#appointmentDate"+f).html($("#gui_appointmentProp_"+(c[0])+"").text())}else{$("#appointmentDate"+f).html(_appointmentChooseDatePrefix+e.length+_appointmentChooseDateSuffix)}$("#appointmentModalRead").modal("hide")}else{alert("__ERROR__")}},error:function(g){console.log(g)}})}$(document).ready(function(){var a=(new Date()).toISOString().replace("T"," ").substring(0,16);$("#new-appointment").attr("placeholder",a);$(".datetimepicker").datetimepicker({format:"YYYY-MM-DD HH:mm",minDate:a.substring(0,10),stepping:10})});function formatPhoneDial(b,a){if(a!=null){return"+"+b+a.replace(/^0/,"").replace(/ /,"")}else{return""}}function formatPhoneDisplay(c,a){if(a!=null){var b=a.replace(/ /,"");return"(+"+c+") "+b.replace(/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/,"$1 $2 $3 $4 $5")}return""}function compareKeyworks(d,c){if(d.word<c.word){return -1}if(d.word>c.word){return 1}return 0}function buildMTHsubPlatforms(){var c="get";var b="mth-sub-platforms";var a="&order=asc&";$.ajax({type:"get",url:"ajax/ajax_proxypass.php?verbe="+c+"&resource="+b+a,dataType:"json",async:true,success:function(d){if(d.hasOwnProperty("success")&&d.success==false){}else{if(d.length===0){}else{$.each(d,function(f,e){$("#mthSubPlatforms").append('<option value="mth_sub_pf_'+e.id+'">'+e.name+"</option>")})}}},error:function(d){console.log(d)}})};