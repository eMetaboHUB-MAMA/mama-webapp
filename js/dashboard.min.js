var nbProjectsWaiting=0;var nbProjectsCompleted=0;var nbProjectsAccepted=0;var nbProjectsAssigned=0;var nbProjectsRunning=0;var nbProjectsArchived=0;var nbProjectsBlocked=0;var nbProjectsRejected=0;var nbProjectsTotal=0;var nbProjectsInChargeWaiting=0;var nbProjectsInChargeCompleted=0;var nbProjectsInChargeAccepted=0;var nbProjectsInChargeAssigned=0;var nbProjectsInChargeRunning=0;var nbProjectsInChargeTotal=0;$(document).ready(function(){loadLang();var a=false;$(".panel.mainBtnOpt").css("cursor","pointer").click(function(){var b=$(this);var c=false;if(!a){c=true}a=true;if(c){document.location=($(b).find("a").attr("href"))}a=false});loadProjectsStats();$.get("templates/projects-light-list-template-"+lang+".html",function(b){$("body").append(b);loadProjectsList(0,10)});$("#events-light-list-container").empty();$.get("templates/events-light-list-template-"+lang+".html",function(b){$("body").append(b);loadEventsList(0,10)});$("#messages-light-list-container").empty();$.get("templates/messages-light-list-template-"+lang+".html",function(b){$("body").append(b);loadMessagesList(0,10)})});function loadProjectsStats(a){var d="get";var c="projects-stats";var b="";if(a!==undefined){b+="&filter="+a}$.ajax({type:"get",url:"ajax/ajax_proxypass.php?verbe="+d+"&resource="+c+b,dataType:"json",async:true,success:function(g){if(g.hasOwnProperty("success")&&g.success==false){}else{if(g.userRight=="project_manager"||g.userRight=="admin"){nbProjectsWaiting=g.allProjectsWaiting;nbProjectsCompleted=g.allProjectsCompleted;nbProjectsAccepted=g.allProjectsAccepted;nbProjectsAssigned=g.allProjectsAssigned;nbProjectsRunning=g.allProjectsRunning;nbProjectsArchived=g.allProjectsArchived;nbProjectsBlocked=g.allProjectsBlocked;nbProjectsRejected=g.allProjectsRejected;nbProjectsInChargeCompleted=g.inChargeProjectsCompleted;nbProjectsInChargeAccepted=g.inChargeProjectsAccepted;nbProjectsInChargeAssigned=g.inChargeProjectsAssigned;nbProjectsInChargeRunning=g.inChargeProjectsRunning;nbProjectsInChargeBlocked=g.inChargeProjectsBlocked;nbProjectsInChargeTotal=nbProjectsInChargeCompleted+nbProjectsInChargeAccepted+nbProjectsInChargeAssigned+nbProjectsInChargeRunning+nbProjectsInChargeBlocked;var l=g.userProjectsWaiting;var k=g.userProjectsAccepted;var f=g.userProjectsAssigned;var i=g.userProjectsCompleted;var h=g.userProjectsRunning;$(".panel-primary.panel-projects").find(".huge").html(nbProjectsInChargeTotal);$(".panel-waiting.panel-projects").find(".huge").html(nbProjectsWaiting);$(".panel-accepted.panel-projects").find(".huge").html(nbProjectsAccepted);$(".panel-assigned.panel-projects").find(".huge").html(nbProjectsAssigned);$(".panel-completed.panel-projects").find(".huge").html(nbProjectsCompleted);$(".panel-info.panel-projects").find(".huge").html(nbProjectsRunning);$("#spanMyWaitingProjects").html(l);$("#spanMyAcceptedProjects").html(k);$("#spanMyAssignedProjects").html(f);$("#spanMyCompletedProjects").html(i);$("#spanMyRunningProjects").html(h);try{buildProjectsStats()}catch(j){}nbProjectsTotal=nbProjectsWaiting+nbProjectsCompleted+nbProjectsAssigned+nbProjectsArchived+nbProjectsBlocked+nbProjectsRejected}else{nbProjectsWaiting=g.userProjectsWaiting;nbProjectsCompleted=g.userProjectsCompleted;nbProjectsAccepted=g.userProjectsAccepted;nbProjectsAssigned=g.userProjectsAssigned;nbProjectsRunning=g.userProjectsRunning;nbProjectsArchived=g.userProjectsArchived;nbProjectsBlocked=g.userProjectsBlocked;nbProjectsRejected=g.userProjectsRejected;nbProjectsTotal=nbProjectsWaiting+nbProjectsCompleted+nbProjectsAccepted+nbProjectsRunning+nbProjectsAssigned+nbProjectsArchived+nbProjectsBlocked+nbProjectsRejected;$(".panel-waiting.panel-projects").find(".huge").html(nbProjectsWaiting);$(".panel-accepted.panel-projects").find(".huge").html(nbProjectsAccepted);$(".panel-completed.panel-projects").find(".huge").html(nbProjectsCompleted);$(".panel-assigned.panel-projects").find(".huge").html(nbProjectsAssigned);$(".panel-completed.panel-projects").find(".huge").html(nbProjectsCompleted);$(".panel-info.panel-projects").find(".huge").html(nbProjectsRunning)}}},error:function(e){console.log(e)}})}function loadProjectsList(f,a,b){$("#projects-light-list-container").empty();var e="get";var d="projects";var c="&start="+f+"&limit="+a;if(b!==undefined){c+="&filter="+b}c+="&order=desc";$.ajax({type:"get",url:"ajax/ajax_proxypass.php?verbe="+e+"&resource="+d+c,dataType:"json",async:true,success:function(h){if(h.hasOwnProperty("success")&&h.success==false){}else{if(h.length===0){$("#noProjectsDiv").show();$("#tableListProjects").hide()}else{$("#projects-light-list-template").tmpl(h).appendTo("#projects-light-list-container");if(h.length>=a){var g=nbProjectsTotal;buildPagination(f,a,b,"projectsPagination","loadProjectsList",g)}}}},error:function(g){console.log(g)}})}function loadEventsList(f,a,b){var e="get";var d="events";var c="&start="+f+"&limit="+a;if(b!==undefined){c+="&filter="+b}c+="&order=desc";$.ajax({type:"get",url:"ajax/ajax_proxypass.php?verbe="+e+"&resource="+d+c,dataType:"json",async:true,success:function(h){if(h.hasOwnProperty("success")&&h.success==false){}else{if(h.length===0){$("#showMoreEventsBtn").hide()}else{if(h.length<a){$("#showMoreEventsBtn").hide()}$("#noEventToShow").hide();var g=new Date();$.each(h,function(j,i){i=eventStatUpdate(i,g)});$("#events-light-list-template").tmpl(h).appendTo("#events-light-list-container");$('[data-toggle="tooltip"]').tooltip();resizeEventsElements()}}},error:function(g){console.log(g)}})}var lastEventStart=0;var lastEventLimit=10;showMoreEvents=function(){lastEventStart+=lastEventLimit;loadEventsList(lastEventStart,lastEventLimit)};showProject=function(a){document.location="?page=projects&showProject="+a};function loadMessagesList(f,a,b){var e="get";var d="messages";var c="&start="+f+"&limit="+a;if(b!==undefined){c+="&filter="+b}c+="&order=desc";c+="&userFilter=receiver";c+="&projectFilter=receiver";c+="&projectPlaceFilter=all";$.ajax({type:"get",url:"ajax/ajax_proxypass.php?verbe="+e+"&resource="+d+c,dataType:"json",async:true,success:function(h){if(h.hasOwnProperty("success")&&h.success==false){}else{if(h.length===0){$("#goToMessagesBtn").hide()}else{$("#noMessageToShow").hide();var g=new Date();$.each(h,function(j,i){i.messageClean=$("<div>").append(i.message).text().replace('"',"&quot;");i=eventStatUpdate(i,g)});$("#messages-light-list-template").tmpl(h).appendTo("#messages-light-list-container");$('[data-toggle="tooltip"]').tooltip()}}},error:function(g){console.log(g)}})};