var nbMessage=0;var currentStart=0;var currentLimit=20;var currentKeyword=null;var filterUsers=false;var filterInCharge=false;var filterInvolved=false;var filterOwner=false;var currentFilter=null;var currentMessageId=null;$(document).ready(function(){loadLang();if(getUrlParameter("keyword")!==undefined){currentKeyword=getUrlParameter("keyword");$("#messagesSearchFilter").val(currentKeyword)}if(getUrlParameter("start")!==undefined){currentStart=getUrlParameter("start")}if(getUrlParameter("limit")!==undefined){currentLimit=getUrlParameter("limit")}if(getUrlParameter("userFilter")!==undefined){if(getUrlParameter("userFilter")=="users"){filterUsers=true;$("#btn-userFilter-users").removeClass("btn-default").addClass("btn-primary")}else{if(getUrlParameter("userFilter")=="inCharge"){filterInCharge=true;$("#btn-userFilter-inCharge").removeClass("btn-default").addClass("btn-primary")}else{if(getUrlParameter("userFilter")=="involved"){filterInvolved=true;$("#btn-userFilter-involved").removeClass("btn-default").addClass("btn-primary")}else{if(getUrlParameter("userFilter")=="owner"){filterOwner=true;$("#btn-userFilter-owner").removeClass("btn-default").addClass("btn-primary")}}}}}loadMessagesStats("");$.get("templates/messages-full-list-template-"+lang+".html",function(a){$("body").append(a);loadMessagesList(currentStart,currentLimit,"")});if(!(userData.right=="admin"||userData.right=="project_manager")){$("#btn-userFilter-inCharge").hide();$("#btn-userFilter-involved").hide()}$("#messageModal_linkToMessage").hide();$("#messagesSearchFilter").bind("keypress",function(b){var a=b.keyCode||b.which;if(a==13){searchMessages()}})});function loadMessagesStats(a){var e="get";var c="messages-count";var b="";var d=false;if(a!==undefined&&a!==null&&a!=""){b+="&filter="+a;d=true}if(currentKeyword!=null){b+="&keywords="+currentKeyword;d=true}if(filterUsers){b+="&projectPlaceFilter=users&noUsers=false";d=true}else{if(filterInCharge){b+="&projectPlaceFilter=inCharge&noUsers=true";d=true}else{if(filterInvolved){b+="&projectPlaceFilter=involved&noUsers=true";d=true}else{if(filterOwner){b+="&projectPlaceFilter=owner&noUsers=true";d=true}}}}$.ajax({type:"get",url:"ajax/ajax_proxypass.php?verbe="+e+"&resource="+c+b,dataType:"json",async:true,success:function(f){if(f.hasOwnProperty("success")&&f.success==false){}else{nbMessage=f;if(nbMessage==0&&!d){$("#noMessagesContent").show();$(".listMessagesContent").hide()}}},error:function(f){console.log(f)}})}function loadMessagesList(g,a,b){$("#messages-full-list-container").empty();var f="get";var d="messages";var c="&start="+g+"&limit="+a;var e=false;if(b!==undefined&&b!==null&&b!=""){c+="&filter="+b;e=true}if(currentKeyword!=null){c+="&keywords="+currentKeyword;e=true}if(filterUsers){c+="&projectPlaceFilter=users&noUsers=false";e=true}else{if(filterInCharge){c+="&projectPlaceFilter=inCharge&noUsers=true";e=true}else{if(filterInvolved){c+="&projectPlaceFilter=involved&noUsers=true";e=true}else{if(filterOwner){c+="&projectPlaceFilter=owner&noUsers=true";e=true}}}}c+="&order=desc";$.ajax({type:"get",url:"ajax/ajax_proxypass.php?verbe="+f+"&resource="+d+c,dataType:"json",async:true,success:function(i){if(i.hasOwnProperty("success")&&i.success==false){}else{if(i.length===0&&!e){$("#noMessagesDiv").show();$("#tableListMessages").hide()}else{$("#noMessagesDiv").hide();$.each(i,function(){if(this.fromUser!==null&&userData.email!=this.fromUser.email){var k=md5(this.fromUser.email.toLowerCase());var j=("https://secure.gravatar.com/avatar/"+k+"?s=25&d=identicon");this.fromUser.avatar=j}if(this.toUser!==null&&userData.email!=this.toUser.email){this.toUser.avatar=("https://secure.gravatar.com/avatar/"+md5(this.toUser.email.toLowerCase())+"?s=25&d=identicon")}this["message"]=$("<div>").append(this.message).text();this["createdLocalDate"]=convertJsonDateToHumanReadable(this.created.date)});$("#messages-full-list-template").tmpl(i).appendTo("#messages-full-list-container");var h=nbMessage;if(h>a){buildPagination(g,a,b,"messagesPagination","loadMessagesList",h)}}}},error:function(h){console.log(h)}})}reloadPage=function(a){var b="?page=messages";if(a!==undefined){b+="&filter="+a}else{if(currentFilter!==null){b+="&filter="+currentFilter}}if(filterUsers){b+="&projectPlaceFilter=users&noUsers=false"}else{if(filterInCharge){b+="&projectPlaceFilter=inCharge&noUsers=true"}else{if(filterInvolved){b+="&projectPlaceFilter=involved&noUsers=true"}else{if(filterOwner){b+="&projectPlaceFilter=owner&noUsers=true"}}}}if($("#messagesSearchFilter").val().trim()!=""){b+="&keyword="+$("#messagesSearchFilter").val().trim()}document.location=b};searchMessages=function(){reloadPage(currentFilter)};addRemoveUserFilter=function(a){var b="?page=messages";if(a=="users"&&!filterUsers){b+="&userFilter=users"}else{if(a=="inCharge"&&!filterInCharge){b+="&userFilter=inCharge"}else{if(a=="involved"&&!filterInvolved){b+="&userFilter=involved"}else{if(a=="owner"&&!filterOwner){b+="&userFilter=owner"}}}}if(currentFilter!==null){b+="&filter="+currentFilter}if($("#messagesSearchFilter").val().trim()!=""){b+="&keyword="+$("#messagesSearchFilter").val().trim()}document.location=b};