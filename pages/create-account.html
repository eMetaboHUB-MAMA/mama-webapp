<div class="container-fluid">
	<div class="row">
		<div class="col-lg-12">
			<h1 class="page-header">
				<span id="create_account_title1" class="lang"></span> <small><span
					id="create_account_title2" class="lang"></span></small>
			</h1>
		</div>
		<!-- /.col-lg-12 -->
	</div>
	<!-- /.row -->
	<div class="row">
		<div class="col-lg-5">
			<form class="form-horizontal" action="?" method="post"
				onsubmit="return checkCreateAccountForm();">
				<fieldset>
					<div id="divLoginError" class="alert alert-danger" role="alert"
						style="display: none;">
						<strong><span id="_warning1_" class="lang"></span></strong> <span
							id="_service_not_available" class="lang"></span>
					</div>
					<div id="divLoginUsed" class="alert alert-warning" role="alert"
						style="display: none;">
						<strong><span id="_warning2_" class="lang"></span></strong> <span
							id="_login_used" class="lang"></span>
					</div>

					<!-- Form Name -->
					<legend>
						<span id="create_account_basic_info" class="lang"></span>
					</legend>

					<!-- Prepended text-->
					<div class="form-group input-group is-mandarotry">
						<span class="input-group-addon"><i class="fa fa-at"></i> <span
							id="create_account_email" class="lang"></span><sup>*</sup></span> <input
							id="email" name="email" type="text"
							class="form-control no-copy-past lang"
							lang="create_account_email_ph" placeholder="enter a valide email"
							aria-describedby="inputSuccess2Status"> <span
							class="fa fa-2x form-control-feedback" aria-hidden="true"></span>
						<span id="inputSuccess2Status" class="sr-only">(success)</span>
					</div>
					<span id="emailHelpBlock" class="help-block"><span
						id="create_account_emailAsLogin" class="lang"></span></span>

					<div class="form-group input-group is-mandarotry">
						<span class="input-group-addon"><i class="fa fa-at"></i> <span
							id="create_account_reemail" class="lang"></span><sup>*</sup></span> <input
							id="emailCheck" type="text"
							class="form-control no-copy-past lang"
							lang="create_account_reemail_ph"
							placeholder="enter a valide email"
							aria-describedby="inputSuccessCheckMailStatus"> <span
							class="fa fa-2x form-control-feedback" aria-hidden="true"></span>
						<span id="inputSuccessCheckMailStatus" class="sr-only">(success)</span>
					</div>
					<span id="emailCheckHelpBlock" class="help-block"></span>

					<div class="form-group input-group is-mandarotry">
						<span class="input-group-addon"><i class="fa fa-key"></i> <span
							id="create_account_password" class="lang"></span><sup>*</sup></span> <input
							id="password" name="password" type="password"
							class="form-control password no-copy-past lang"
							lang="create_account_password_ph"
							placeholder="enter a (strong) password"
							aria-describedby="inputSuccess3Status"> <span
							class="fa fa-2x form-control-feedback" aria-hidden="true"></span>
						<span id="inputSuccess3Status" class="sr-only">(success)</span>
					</div>
					<span id="passwordHelpBlock" class="help-block"></span>

					<div class="form-group input-group is-mandarotry">
						<span class="input-group-addon"><i class="fa fa-key"></i> <span
							id="create_account_repassword" class="lang"></span><sup>*</sup></span> <input
							id="repassword" type="password"
							class="form-control password no-copy-past lang"
							lang="create_account_repassword_ph"
							placeholder="re-enter the same password"
							aria-describedby="inputSuccess4Status"> <span
							class="fa fa-2x form-control-feedback" aria-hidden="true"></span>
						<span id="inputSuccess4Status" class="sr-only">(success)</span>
					</div>
					<span id="rePasswordHelpBlock" class="help-block"></span>

				</fieldset>
			</form>
		</div>

		<div class="col-lg-1"></div>

		<div id="account-user-data" class="col-lg-6" style="">
			<form class="form-horizontal" action="?" method="post"
				onsubmit="return checkCreateAccountForm();">
				<fieldset>

					<!-- Form Name -->
					<legend>
						<span id="create_account_userData" class="lang"></span>
					</legend>

					<div class="form-group input-group">
						<span class="input-group-addon"><i class="fa fa-user"></i>
							<span id="create_account_userFirstName" class="lang"></span></span> <input
							id="firstName" name="firstName" type="text"
							class="form-control lang" lang="create_account_userFirstName_ph"
							placeholder="enter your first name">
					</div>

					<div class="form-group input-group">
						<span class="input-group-addon"><i class="fa fa-user"></i>
							<span id="create_account_userLastName" class="lang"></span></span></span> <input
							id="lastName" name="lastName" type="text"
							class="form-control lang" lang="create_account_userLastName_ph"
							placeholder="enter your last name">
					</div>

					<div class="form-group input-group">
						<span class="input-group-addon" style="max-width: 40%;"><i
							class="fa fa-phone"></i> <span
							id="create_account_userCallingCode" class="lang"></span></span> <select
							id="phoneGroup" name="phoneGroup" style="max-width: 40%;"
							class="form-control phoneGroup">
							<option id="create_account_chooseListPhone" class="lang" value=""
								class="lang" disabled="disabled"></option>
						</select> <input id="phoneNumber" name="phoneNumber" type="text"
							class="form-control lang" style="max-width: 60%;"
							lang="create_account_userCallingCode_ph"
							placeholder="enter your phone">
					</div>

					<div class="form-group input-group">
						<span class="input-group-addon"><i class="fa fa-building"></i>
							<span id="create_account_userLaboOrCompagny" class="lang"></span></span>
						<input id="laboratoryOrCompagny" name="laboratoryOrCompagny"
							type="text" class="form-control lang"
							lang="create_account_userLaboOrCompagny_ph"
							placeholder="enter your Laboratory or Company name">
					</div>

					<div class="form-group">
						<span class="input-group-addon"><i class="fa fa-map-marker"></i>
							<span id="create_account_userWorkplaceAddress" class="lang"></span></span>
						<textarea id="workplaceAddress" name="workplaceAddress"
							class="form-control lang" rows="4"
							lang="create_account_userWorkplaceAddress_ph"
							placeholder="enter your full adress, country included"></textarea>
					</div>

					<div class="form-group input-group">
						<span class="input-group-addon"><span
							id="create_account_userTypeOfLabo" class="lang"></span></span> <select
							id="typeOfLaboratoryOrCompany" name="typeOfLaboratoryOrCompany"
							class="form-control">
							<option selected disabled>-</option>
							<option class="lang" id="create_account_userTypeOfLabo_private"
								value="private">private</option>
							<option class="lang" id="create_account_userTypeOfLabo_public"
								value="public">public</option>
							<option class="lang"
								id="create_account_userTypeOfLabo_privatePublic"
								value="public_private">mix private / public</option>
						</select>
					</div>

					<button id="btn-create-user" type="submit" disabled="disabled"
						class="btn btn-primary btn-disabled">
						<span id="create_account_userBtnCreateUser" class="lang"></span>
					</button>

				</fieldset>
			</form>
		</div>

		<!-- 		<div id="account-group-data" class="col-lg-4" style="display: none;"> -->
		<!-- 			<form class="form-horizontal"> -->
		<!-- 				<fieldset> -->

		<!-- 					Form Name -->
		<!-- 					<legend>group informations</legend> -->

		<!-- 					<div class="form-group input-group"> -->
		<!-- 						<span class="input-group-addon"><i class="fa fa-users"></i> -->
		<!-- 							Group name</span> <input id="groupName" type="text" class="form-control" -->
		<!-- 							placeholder="enter your group name"> -->
		<!-- 					</div> -->

		<!-- 					<div class="form-group input-group"> -->
		<!-- 						<span class="input-group-addon"><i class="fa fa-at"></i> -->
		<!-- 							email of group administrator</span> <input id="email2" type="text" -->
		<!-- 							class="form-control" placeholder="enter a valide email" -->
		<!-- 							aria-describedby="inputSuccessGrpEmailStatus"> <span -->
		<!-- 							class="fa fa-2x form-control-feedback" aria-hidden="true"></span> -->
		<!-- 						<span id="inputSuccessGrpEmailStatus" class="sr-only">(success)</span> -->
		<!-- 					</div> -->
		<!-- 					<span id="email2HelpBlock" class="help-block"></span> -->

		<!-- 					<div class="form-group input-group"> -->
		<!-- 						<span class="input-group-addon" style="max-width: 40%;"><i -->
		<!-- 							class="fa fa-phone"></i> Group phone</span> <select id="phoneGroup" -->
		<!-- 							style="max-width: 40%;" class="form-control phoneGroup"> -->
		<!-- 							<option value="" disabled="disabled">choose in list...</option> -->
		<!-- 														<option value="+1">USA (+1)</option> -->
		<!-- 														<option value="+33">France (+33)</option> -->
		<!-- 														<option value="+44">UK (+44)</option> -->
		<!-- 						</select> <input id="phoneNumber" name="phoneNumber" type="text" class="form-control" -->
		<!-- 							style="max-width: 60%;" placeholder="enter your group phone"> -->
		<!-- 					</div> -->

		<!-- 					<button type="button" class="btn btn-primary ">Create -->
		<!-- 						group</button> -->

		<!-- 				</fieldset> -->
		<!-- 			</form> -->
	</div>
</div>
</div>

<script type="text/javascript">
	var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z\-0-9]{2,}))$/
	var reLDAP = /@([a-zA-Z\-0-9]+\.)?inrae?\.fr$/
	$("#email").focusout(function() {
		checkMail(this);
	}).focus();
	$("#emailCheck").focusout(function() {
		checkMailRetype(this);
	});
	$("#email2").focusout(function() {
		checkMail(this);
	});

	$(document).on("cut copy paste", ".no-copy-past", function(e) {
		e.preventDefault();
	});

	$("#password").focusout(
			function() {
				$(this).parent().removeClass(
						"has-error has-success has-warning has-feedback");
				$(this).parent().find(".fa").removeClass("fa-check fa-times");
				var passStrength = 0;
				var password = $(this).val();
				if (password.length > 10)
					passStrength = 2;
				else if (password.length > 5)
					passStrength = 1;
				switch (passStrength) {
				case 0:
					$(this).parent().addClass("has-error has-feedback");
					$(this).parent().find(".fa").addClass("fa-times");
					$("#passwordHelpBlock").html(
							create_account_error_weak_password);
					break;
				case 1:
					$(this).parent().addClass("has-warning has-feedback");
					$(this).parent().find(".fa").addClass("fa-check");
					$("#passwordHelpBlock").html(
							create_account_warning_weak_password);
					break;
				case 2:
					$(this).parent().addClass("has-success has-feedback");
					$(this).parent().find(".fa").addClass("fa-check");
					$("#passwordHelpBlock").html("");
					break;
				}
			});

	$(".password").focusout(
			function() {
				$("#repassword").parent().removeClass(
						"has-error has-success has-feedback");
				$("#repassword").parent().find(".fa").removeClass(
						"fa-check fa-times");
				if ($("#password").val() == $("#repassword").val()
						&& $("#repassword").val() != "") {
					$("#repassword").parent().addClass(
							"has-success has-feedback");
					$("#repassword").parent().find(".fa").addClass("fa-check");
					$("#rePasswordHelpBlock").html("");
				} else if ($("#repassword").val() != "") {
					$("#repassword").parent()
							.addClass("has-error has-feedback");
					$("#repassword").parent().find(".fa").addClass("fa-times");
					$("#rePasswordHelpBlock").html(
							create_account_error_passwords_no_match);
				}
			});

	// 
	$("#accountTypeUser").click(function() {
		$("#account-user-data").show();
		$("#account-group-data").hide();
	});
	$("#accountTypeGroup").click(function() {
		$("#account-group-data").show();
		$("#account-user-data").hide();
	});

	/**
	 * check users emails
	 */
	function checkMail(elem) {
		var email = $(elem).val();
		if (!email.match(re)) {
			$(elem).parent().removeClass("has-success has-feedback").addClass(
					"has-error has-feedback");
			$(elem).parent().find(".fa").removeClass("fa-check").addClass(
					"fa-times");
			$("#" + ($(elem).prop('id')) + "HelpBlock").html(
					create_account_error_invalid_email);
		} else {
			$(elem).parent().addClass("has-success has-feedback").removeClass(
					"has-error has-feedback");
			$(elem).parent().find(".fa").removeClass("fa-times").addClass(
					"fa-check");
			$("#" + ($(elem).prop('id')) + "HelpBlock").html("");
			if (email.match(reLDAP)) {
				$("#" + ($(elem).prop('id')) + "HelpBlock").html(create_account_warning_ldap_email);
			}
		}
	}

	function checkMailRetype(elem) {
		var email = $(elem).val();
		if (email != $("#email").val()) {
			$(elem).parent().removeClass("has-success has-feedback").addClass(
					"has-error has-feedback");
			$(elem).parent().find(".fa").removeClass("fa-check").addClass(
					"fa-times");
			$("#" + ($(elem).prop('id')) + "HelpBlock").html(
					create_account_error_emails_no_match);
		} else {
			$(elem).parent().addClass("has-success has-feedback").removeClass(
					"has-error has-feedback");
			$(elem).parent().find(".fa").removeClass("fa-times").addClass(
					"fa-check");
			$("#" + ($(elem).prop('id')) + "HelpBlock").html("");
		}
	}

	$.getJSON("json/codes_countries.json", function(data) {
		// load data from json
		$.each(data, function() {
			if (this.country == "France")
				$(".phoneGroup").append(
						'<option value="'+this.code+'" selected="selected">'
								+ this.country + ' (+' + this.code
								+ ')</option>');
			else
				$(".phoneGroup").append(
						'<option value="'+this.code+'">' + this.country + ' (+'
								+ this.code + ')</option>');
		});

	});

	$(".form-control").change(
			function() {
				setTimeout(function() {
					var success = true;
					$.each($("input.form-control:visible"),
							function() {
								if ($(this).parent().hasClass(
										"has-error has-feedback")) {
									success = false;
								}
								if ($(this).parent().hasClass("is-mandarotry")
										&& $(this).val() == "") {
									success = false;
								}
							});
					$("#btn-create-user").removeClass("btn-disabled");
					$("#btn-create-user").prop("disabled", false);
					if (success) {

					} else {
						$("#btn-create-user").addClass("btn-disabled");
						$("#btn-create-user").prop("disabled", true);
					}
				}, 50);
			});

	checkCreateAccountForm = function() {
		var verbe = "post";
		var resource = "user";
		var params = "";
		$.each($("form input"), function(k, v) {
			params += "&" + $(this).prop('id') + "="
					+ encodeURIComponent($("#" + $(this).prop('id')).val());
		});
		$.each($("form select"), function(k, v) {
			params += "&" + $(this).prop('id') + "="
					+ $("#" + $(this).prop('id')).val();
		});
		$.each($("form textarea"), function(k, v) {
			params += "&" + $(this).prop('id') + "="
					+ encodeURIComponent($("#" + $(this).prop('id')).val());
		});
		// run
		$.ajax({
			type : "post",
			url : "ajax/ajax_proxypass.php?verbe=" + verbe + "&resource="
					+ resource + "&lang=" + lang,
			dataType : "json",
			async : true,
			data : params,
			success : function(json) {
				if (json.success) {
					location.search = "?page=dashboard";
					//location.reload();
				} else {
					// show wrong password info
					$("#divLoginUsed").show();
				}
			},
			error : function(xhr) {
				console.log(xhr);
				// show error message info
				$("#divLoginError").show();
			}
		});
		return false;
	}
</script>
